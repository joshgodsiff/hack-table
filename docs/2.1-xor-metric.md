# 2.1 XOR Metric

Each Kademlia node has a 160-bit node ID. Node IDs are currently just random 160-bit identifiers, though they could equally well be constructed as in Chord. Every message a node transmits includes its node ID, permitting the recipient to record the sender's existence if necessary.

Keys, too, are 160-bit identifiers. To assign (key,value) pairs to particular nodes, Kademlia relies on a notion of distance between two identifiers. Given two 160-bit identifiers, x and y, Kademlia defines the distance between them as their bitwise exclusive or (XOR) interpreted as an integer, d(x,y) = x ⊕ y.

We first note that XOR is a valid, albeit non-Euclidean metric. It is obvious that that d(x,x) = 0, d(x,y) > 0 if x ≠ y, and ∀x,y : d(x,y) = d(y,x). XOR also offers the triangle property: d(x,y) + d(y,z) ≥ d(x,z). The triangle property follows from the fact that d(x,y) ⊕ d(y,z) = d(x,z) and ∀a > 0, b > 0 : a + b > a ⊕ b.

We next note that XOR captures the notion of distance implicit in our binary-tree-based sketch of the system. In a fully-populated binary tree of 160-bit IDs, the magnitude of the distance between two IDs is the height of the smallest subtree containing them both. When a tree is not fully populated, the closest leaf to an ID x is the leaf whose ID shares the longest common prefix of x. If there are empty branches in the tree, there might be more than one leaf with the longest common prefix. In that case, the closest leaf to x will be the closest leaf to ID ⭬ produced by flipping the bits in x corresponding to the empty branches of the tree.

Like Chord's clockwise circle metric, XOR is unidirectional. For any given point x and distance Δ > 0, there is exactly one point y such that d(x,y) = Δ. Unidirectionality ensures that all lookups for the same key converge along the same path, regardless of the originating node. Thus, caching (key,value) pairs along the lookup path alleviates hot spots. Like Pastry and unlike Chord, the XOR topology is also symmetric (d(x,y) = d(y,x) for all x and y).